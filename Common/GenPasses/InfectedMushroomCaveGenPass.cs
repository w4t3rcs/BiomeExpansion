using BiomeExpansion.Content.Tiles.Biome;
using BiomeExpansion.Content.Tiles.Plants;
using BiomeExpansion.Content.Tiles.Stones;
using BiomeExpansion.Content.Walls;
using BiomeExpansion.Core.Generation;
using BiomeExpansion.Helpers;
using Terraria;
using Terraria.IO;
using Terraria.ModLoader;
using Terraria.WorldBuilding;

namespace BiomeExpansion.Common.GenPasses;

public class InfectedMushroomCaveGenPass(string name, double loadWeight) : GenPass(name, loadWeight)
{
    protected override void ApplyPass(GenerationProgress progress, GameConfiguration configuration)
    { 
        progress.Message = "Generating Cave Infected Mushroom biome...";
        var caveBiomeBuilder = GenerationHelper.CreateCaveBiomeBuilder()
            .Biome(BEBiome.InfectedMushroomCave)
            .BiomePlacer(GenerationHelper.RectangleBiomePlacer)
            .Deepness(200)
            .IsDependentBiome()
            .AboveBiome(BEBiome.InfectedMushroomSurface)
            .GroundModification(GenerationHelper.TwoDirectionDiagonalTunnelModification);
        if (!WorldGen.crimson)
        {
            caveBiomeBuilder = caveBiomeBuilder
                .DefaultCaveTileGenerationStep()
                    .GenerationId(GenerationHelper.MainGenerationId)
                    .TileType(ModContent.TileType<CrimsonInfectedMushroomStone>())
                    .AndCave()
                .WallGenerationStep()
                    .WallType(ModContent.WallType<CrimsonInfectedMushroomStoneWall>())
                    .WallPlacer(GenerationHelper.SimpleWallPlacer)
                    .AndCave()
                .WallGenerationStep()
                    .WallType(ModContent.WallType<CrimsonInfectedMushroomOldStoneWall>())
                    .WallPlacer(GenerationHelper.SimpleWallPlacer)
                    .TileBehindWall(ModContent.TileType<CrimsonInfectedMushroomOldStone>())
                    .AndCave()
                .GroundDecorationGenerationStep()
                    .TileType(ModContent.TileType<CrimsonInfectedMushroomCaveBigPlant>())
                    .Rarity(35)
                    .DecorationPlacer(GenerationHelper.SimpleDecorationPlacer)
                    .AndCave()
                .GroundDecorationGenerationStep()
                    .TileType(ModContent.TileType<CrimsonInfectedMushroomCaveRock>())
                    .Rarity(7)
                    .DecorationPlacer(GenerationHelper.SimpleDecorationPlacer)
                    .FrameCount(3)
                    .AndCave()
                .GroundDecorationGenerationStep()
                    .TileType(ModContent.TileType<CrimsonInfectedMushroomCaveBigMushroom>())
                    .Rarity(7)
                    .DecorationPlacer(GenerationHelper.SimplePlantPlacer)
                    .FrameCount(2)
                    .AndCave()
                .GroundDecorationGenerationStep()
                    .TileType(ModContent.TileType<CrimsonInfectedMushroomCaveVines>())
                    .Rarity(4)
                    .DecorationPlacer(GenerationHelper.VinePlacer)
                    .AndCave()
                .GroundDecorationGenerationStep()
                    .TileType(ModContent.TileType<CrimsonInfectedMushroomCaveBulbVines>())
                    .Rarity(4)
                    .DecorationPlacer(GenerationHelper.VinePlacer)
                    .AndCave()
                .GroundDecorationGenerationStep()
                    .TileType(ModContent.TileType<CrimsonInfectedMushroomCaveThorns>())
                    .Rarity(200)
                    .DecorationPlacer(GenerationHelper.BunchPlacer)
                    .AndCave()
                .GroundDecorationGenerationStep()
                    .TileType(ModContent.TileType<CrimsonInfectedMushroomCaveTallGrass>())
                    .Rarity(3)
                    .DecorationPlacer(GenerationHelper.SimplePlantPlacer)
                    .FrameCount(16)
                    .AndCave()
                .OreGenerationStep()
                    .TileType(ModContent.TileType<CrimsonInfectedMushroomOldStone>())
                    .Rarity(325)
                    .Strength(WorldGen.genRand.Next(9, 16))
                    .Steps(WorldGen.genRand.Next(10, 18))
                    .AndCave()
                .OreGenerationStep()
                    .TileType(ModContent.TileType<CrimsoomOre>())
                    .Rarity(150)
                    .Strength(WorldGen.genRand.Next(3, 6))
                    .Steps(WorldGen.genRand.Next(2, 6))
                    .AndCave();
        }
        else 
        {
            caveBiomeBuilder = caveBiomeBuilder
                .DefaultCaveTileGenerationStep()
                    .GenerationId(GenerationHelper.MainGenerationId)
                    .TileType(ModContent.TileType<CorruptionInfectedMushroomStone>())
                    .AndCave()
                .WallGenerationStep()
                    .WallType(ModContent.WallType<CorruptionInfectedMushroomStoneWall>())
                    .WallPlacer(GenerationHelper.SimpleWallPlacer)
                    .AndCave()
                .WallGenerationStep()
                    .WallType(ModContent.WallType<CorruptionInfectedMushroomOldStoneWall>())
                    .WallPlacer(GenerationHelper.SimpleWallPlacer)
                    .TileBehindWall(ModContent.TileType<CorruptionInfectedMushroomOldStone>())
                    .AndCave()
                .GroundDecorationGenerationStep()
                    .TileType(ModContent.TileType<CorruptionInfectedMushroomCaveBigPlant>())
                    .Rarity(35)
                    .DecorationPlacer(GenerationHelper.SimpleDecorationPlacer)
                    .AndCave()
                .GroundDecorationGenerationStep()
                    .TileType(ModContent.TileType<CorruptionInfectedMushroomCaveRock>())
                    .Rarity(7)
                    .DecorationPlacer(GenerationHelper.SimpleDecorationPlacer)
                    .FrameCount(3)
                    .AndCave()
                .GroundDecorationGenerationStep()
                    .TileType(ModContent.TileType<CorruptionInfectedMushroomCaveBigMushroom>())
                    .Rarity(7)
                    .DecorationPlacer(GenerationHelper.SimplePlantPlacer)
                    .FrameCount(2)
                    .AndCave()
                .GroundDecorationGenerationStep()
                    .TileType(ModContent.TileType<CorruptionInfectedMushroomCaveVines>())
                    .Rarity(4)
                    .DecorationPlacer(GenerationHelper.VinePlacer)
                    .AndCave()
                .GroundDecorationGenerationStep()
                    .TileType(ModContent.TileType<CorruptionInfectedMushroomCaveBulbVines>())
                    .Rarity(4)
                    .DecorationPlacer(GenerationHelper.VinePlacer)
                    .AndCave()
                .GroundDecorationGenerationStep()
                    .TileType(ModContent.TileType<CorruptionInfectedMushroomCaveThorns>())
                    .Rarity(200)
                    .DecorationPlacer(GenerationHelper.BunchPlacer)
                    .AndCave()
                .GroundDecorationGenerationStep()
                    .TileType(ModContent.TileType<CorruptionInfectedMushroomCaveTallGrass>())
                    .Rarity(3)
                    .DecorationPlacer(GenerationHelper.SimplePlantPlacer)
                    .FrameCount(16)
                    .AndCave()
                .OreGenerationStep()
                    .TileType(ModContent.TileType<CorruptionInfectedMushroomOldStone>())
                    .Rarity(325)
                    .Strength(WorldGen.genRand.Next(9, 16))
                    .Steps(WorldGen.genRand.Next(10, 18))
                    .AndCave()
                .OreGenerationStep()
                    .TileType(ModContent.TileType<CorruptoomOre>())
                    .Rarity(150)
                    .Strength(WorldGen.genRand.Next(3, 6))
                    .Steps(WorldGen.genRand.Next(2, 6))
                    .AndCave();
        }
        
        caveBiomeBuilder.Generate();
    }
}